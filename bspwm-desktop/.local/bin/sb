#!/usr/bin/guile -s
!#
(use-modules (ice-9 format)
             (ice-9 popen)
             (ice-9 rdelim))

(let*
    ((bspc-report (open-pipe* OPEN_READ "bspc" "subscribe" "report"))
     (bar-input (open-pipe* OPEN_WRITE
                            "lemonbar"
                            "-f Monospace"
                            "-u 12"
                            "-o 0"))
     (bar-output (open-pipe* OPEN_BOTH "status_bar_content")))
  (begin
    (while #t
      (format bar-output "~a~%" (read-line bspc-report))
      (format bar-input "~a~%" (read-line bar-output)))
    (close-pipe bspc-report)
    (close-pipe bar-input)
    (close-pipe bar-output)))
